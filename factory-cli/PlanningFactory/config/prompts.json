{
  "signal_enrichment": {
    "template": "\n**TASK:**\nAnalyze the encounter context below and extract clinical signals relevant to:\n{{riskFactorInstructions}}\n\nUse ONLY the patient_payload as your factual source.\n\n**TARGET SIGNAL GROUPS (use definitions from metric_context.signal_group_definitions):**\n- {{signalGroupIds}}\n\n**REQUIRED JSON SCHEMA:**\n{\n  \"signal_groups\": [\n    {\n      \"group_id\": \"string (one of: {{signalGroupIdsComma}})\",\n      \"signals\": [\n        {\n          \"signal_id\": \"<short id>\",\n          \"description\": \"<short clinical description>\",\n          \"evidence_type\": \"verbatim_text | structured_field\",\n          \"provenance\": \"<exact text snippet supporting this signal>\"\n        }\n      ]\n    }\n  ]\n}\n\n**STRICT RULES:**\n- DO NOT invent facts, timestamps, symptoms, or documentation.\n- DO NOT use guidelines, protocols, best-practice teaching, or general clinical theory.\n- Every signal MUST have provenance: a verbatim text snippet from patient_payload.\n- All extracted signals MUST be directly relevant to evaluating {{metricName}}.\n- Signal cap per group: OFF (return every relevant signal); if none exist, return an explicit empty array for that group.\n\n**EXTRACTION GUIDANCE:**\n{{reviewQuestionGuidance}}\n\n**SIGNAL TYPE PRIORITIES:**\n{{archetypePriorities}}\n\nSAFETY SIGNALS (All archetypes):\n- Complications or near-misses documented\n- Red flag symptoms or findings\n- Escalation events or code situations\n\nDOCUMENTATION GAPS (All archetypes):\n- Missing required assessments or evaluations\n- Incomplete procedural documentation\n- Ambiguities that prevent metric determination\n\n**QUALITY EXPECTATIONS:**\n- Prefer fewer high-yield signals over many low-value ones.\n- Keep descriptions short and clinical.\n- Ensure every signal helps evaluate {{metricName}}.\n\n**REMINDER (METRIC ANCHOR):**\nAll extracted signals MUST help determine whether THIS case meets:\n\n\"{{metricName}}\"\n\nClinical Focus: {{clinicalFocus}}\n\nDo NOT extract unrelated findings.\n"
  },
  "event_summary": {
    "template": "\n**Context:**\n- Domain: {{domain}}\n- Archetype: {{archetype}}\n- Metric: {{metricName}}\n- Clinical Focus: {{clinicalFocus}}\n{{rankingContextLine}}\n\n**GOAL:**\nProduce a factual, timeline-focused summary relevant to evaluating {{metricName}}.\n- Focus on events directly relevant to the metric definition.\n- Flag delays, gaps, or safety concerns.\n- Structure the narrative chronologically when possible.\n\n**BAD EXAMPLE (Do Not Do This):**\n\"The patient arrived and standard protocols suggest early intervention. It is important to monitor...\" (Too generic, lecturing).\n\n**GOOD EXAMPLE:**\n\"Patient arrived at 14:00. Key intervention at 15:30 (90 min from arrival). Timeline documented; no unexplained gaps.\" (Fact-based, metric-focused).\n\n**REQUIRED JSON SCHEMA:**\n{\n  \"event_summary\": \"Comprehensive narrative summary of events relevant to {{metricName}}...\",\n  \"timeline_complete\": true | false,\n  \"key_timestamps\": [\"timestamp1\", \"timestamp2\", \"...\"]\n}\n\n**TIMESTAMP RULE:**\n- Use ISO-8601 if explicitly documented; otherwise copy the exact textual timestamp strings from the chart (no invented times).\n"
  },
  "20_80_display_fields": {
    "template": "\nYour job is to generate a \"20/80 Summary\" \u0192?\" the 20% of clinically meaningful facts\nthat explain 80% of the case for evaluating: {{metricName}}.\n\n**STRICT RULES:**\n- Use ONLY the patient_payload as factual source.\n- No guessing, no clinical advice, no guidelines.\n- No commentary on quality of care, workflows, or protocols.\n- No abstract teaching statements.\n- No invented timestamps, conditions, or events.\n- Everything must map to real patient_payload elements.\n- If something is not documented, omit it.\n- provider_summary must restate facts only; no opinions, judgments, or recommendations.\n\n**BAD VS GOOD EXAMPLES:**\nBAD EXAMPLE (Do NOT write like this):\n\"Patients with fractures typically require rapid surgical intervention, and delays \nmay increase complications. It is important to monitor swelling.\"\n\nWhy bad:\n- Generic teaching\n- Not specific to the chart\n- Not tied to metric thresholds\n\nGOOD EXAMPLE (This is the style you MUST follow):\n\"Key events and timestamps that define metric evaluation.\nFocus on signal groups: {{signalGroupIds}}.\"\n\nWhy good:\n- Purely structural\n- Metric-focused\n- No fabricated patient facts\n- Uses signal groups relevant to {{metricName}}\n\n**GOAL:**\nProduce:\n- patient_summary: factual, timeline-focused (what happened).\n- provider_summary: what matters most for quality, safety, and metric risk.\n\nUse only the 20% of facts that drive 80% of insight.\nDo not invent data or recommend policy.\n\n{{rankingContextLine}}\n\n**REQUIRED JSON SCHEMA:**\n{ \"patient_summary\": \"...\", \"provider_summary\": \"...\" }\n"
  },
  "followup_questions": {
    "template": "\nYour job is to generate 5\u0192?\"10 short, case-specific follow-up questions\nto help a clinician quickly review THIS specific case for: {{metricName}}.\n\n**STRICT RULES:**\n- Use ONLY the patient_payload as factual source.\n- Focus on what is missing, unclear, conflicting, or delayed.\n- Do NOT ask about general policies, protocols, training, or system design.\n- Do NOT ask about abstract \"best practices\" or guidelines.\n- Do NOT invent facts, timestamps, or events.\n- Each question must be specific to THIS case, not generic.\n- Each question must reference a concrete chart element (documented timestamp, order, finding, or note section).\n- Prefer questions that point to:\n  - missing documentation,\n  - unclear timing,\n  - unclear indications,\n  - unexplained delays,\n  - conflicting entries.\n\n**QUESTION THEMES TO CONSIDER:**\nAnchor questions on these signal groups: {{signalGroupList}}\n\n{{reviewQuestionHints}}\n\n**BAD VS GOOD EXAMPLES:**\nBAD EXAMPLE (do NOT ask questions like this):\n- \"Are our hospital's protocols up to date?\"\n- \"What general steps should be taken to prevent delays?\"\n\nWhy bad:\n- About hospital policies / systems, not this patient.\n- Not grounded in the patient_payload.\n- Too generic.\n\nGOOD EXAMPLE (this is the style you MUST follow):\n- \"Is there documentation explaining the delay between ED arrival and procedure start time?\"\n- \"Can we clarify why the intervention timeline differs from what was expected?\"\n\nWhy good:\n- Tied to specific timing / indication that should be in the chart.\n- Focused on missing or unclear documentation for THIS case.\n- Clearly relevant to {{metricName}}.\n\n**OUTPUT FORMAT:**\nReturn a JSON object with 5\u0192?\"10 questions:\n\n{\n  \"followup_questions\": [\n    \"Question 1?\",\n    \"Question 2?\",\n    \"...\",\n    \"Question N?\"\n  ]\n}\n\nRequirements:\n- 5 to 10 questions total.\n- Each question must be a single, concise sentence.\n- No numbering, no bullets, no extra commentary.\n- No explanation outside the JSON structure.\n\nAnalyze the patient_payload and generate the JSON object described above.\n"
  },
  "clinical_review_plan": {
    "template": "\nYour job is to evaluate THIS SPECIFIC CASE against \"{{metricName}}\" and produce a\nclear, concise, factual clinical assessment grounded ONLY in the patient_payload.\n\n**METRIC FOCUS:** {{clinicalFocus}}\n\n**WHAT YOU MUST DO:**\nUsing ONLY the patient_payload, produce a clinical reviewer output containing:\n1. metric_alignment: \n   - A concise statement of whether the documented events align, appear to violate,\n     or are unclear/incompletely documented relative to the metric threshold.\n   - Limit to 2\u20113 sentences; stay terse.\n2. key_factors:\n   - 3\u0192?\"6 short bullet points identifying the most relevant facts.\n   - Facts must come STRICTLY from the patient_payload.\n3. concerns_or_flags:\n   - Short, specific items that a clinician may need to review (e.g., unclear timing,\n     missing documentation, conflicting entries, unverified indications).\n4. overall_call:\n   - One of: \"clear_pass\", \"clear_fail\", \"needs_clinical_review\".\n   - If unclear or conflicting documentation exists \u0192+' choose \"needs_clinical_review\".\n\n**STRICT RULES:**\n- Use ONLY patient_payload as factual source.\n- DO NOT speculate or guess.\n- DO NOT introduce guidelines, protocols, best practices, or teaching content.\n- DO NOT invent timestamps, dosages, indications, or events.\n- Keep the tone clinical, factual, terse.\n- All statements must be directly traceable to the payload.\n- If the payload does not contain enough information, explicitly mark it as:\n  \"documentation unclear\" or \"information missing.\"\n\n**BAD VS GOOD EXAMPLES:**\nBAD EXAMPLE (do NOT write like this):\n\"The standard of care for fractures requires early intervention, and clinicians\nshould consider monitoring for compartment syndrome. Guidelines emphasize...\"\n\nWhy bad:\n- Teaching tone\n- Guidelines instead of patient facts\n- Not tied to this specific case\n\nGOOD EXAMPLE (follow this style):\n\"OR start time is documented but the reason for delay before transfer is unclear.\nIndication for line continuation after day X is not documented.\"\n\nWhy good:\n- Factual + case-specific\n- Identifies uncertainty\n- No policy or teaching language\n- Directly tied to metric evaluation\n\n**OUTPUT FORMAT (REQUIRED):**\nReturn the following JSON structure ONLY:\n\n{\n  \"clinical_reviewer\": {\n    \"metric_alignment\": \"...\",\n    \"key_factors\": [\n      \"...\",\n      \"...\",\n      \"...\"\n    ],\n    \"concerns_or_flags\": [\n      \"...\",\n      \"...\"\n    ],\n    \"overall_call\": \"clear_pass | clear_fail | needs_clinical_review\"\n  }\n}\n\nRules:\n- No explanations outside the JSON.\n- No nested reasoning.\n- No chain-of-thought.\n- Keep all fields concise and metric-focused.\n\nAnalyze the patient_payload and generate ONLY the JSON described above.\n"
  },
  "multi_archetype_synthesis_draft": {
    "template": "\n**GOAL (STEP 1 \u0192?\" DRAFT):**\nYou are synthesizing findings from multiple specialist lanes into ONE coherent,\nmetric-focused synthesis for THIS specific case.\n\nYou must:\n- Combine all relevant facts from the lane findings.\n- Highlight areas of agreement and disagreement between lanes.\n- Keep your focus strictly on the metric and this encounter.\n{{rankingContextLine}}\n\n**INPUTS:**\n- Domain: {{domain}}\n- Primary Archetype: {{archetype}}\n- Lane Findings JSON (each lane is already metric-focused and schema-validated):\n{{laneFindings}}{{rankingContextSection}}\n\n**STRICT RULES:**\n- Use ONLY the lane findings as your factual source.\n- Do NOT invent new facts, dates, or events that are not present in the lanes.\n- Do NOT introduce guidelines, policies, or general teaching content.\n- Do NOT speculate on causes not mentioned in any lane.\n- If lanes conflict or disagree, clearly mark it as \"lane disagreement\" instead of\n  resolving it yourself.\n\n**WHAT TO PRODUCE:**\n- A single JSON object using the EXISTING multi_archetype_synthesis schema\n  (do NOT change field names or structure).\n- Populate:\n  - The overall synthesis / summary field(s).\n  - Any fields describing agreement/disagreement between lanes.\n  - Any fields describing key factors or flags for review.\n\n**CRITICAL CONSTRAINTS:**\n- Every factual statement in your synthesis MUST be traceable to at least one\n  lane finding.\n- If a conclusion cannot be directly supported by lane text, you MUST either:\n  - omit it, OR\n  - phrase it explicitly as \"uncertain \u0192?\" requires clinical review\".\n- When filling merged_signal_groups.signals, use the same evidence structure as lanes:\n  - evidence_type: \"L1 | L2 | L3\" (lane-level evidence labels only).\n  - provenance: { \"source_text\": \"...\", \"timestamps\": \"...\" } derived from lanes.\n\n**REQUIRED JSON SCHEMA:**\n{\n  \"final_determination\": \"string (Summary of final status)\",\n  \"synthesis_rationale\": \"string (Why this determination was reached)\",\n  \"merged_signal_groups\": [\n    {\n      \"group_id\": \"...\",\n      \"signals\": [\n        {\n          \"id\": \"...\",\n          \"description\": \"Full text description\",\n          \"evidence_type\": \"L1 | L2 | L3\",\n          \"provenance\": { \"source_text\": \"...\", \"timestamps\": \"...\" },\n          \"feasibility\": { \"cpt_codes\": [], \"icd_codes\": [] }\n        }\n      ]\n    }\n  ],\n  \"unified_clinical_tools\": []\n}\n\nReturn ONLY the JSON object. No explanations, no chain-of-thought.\n"
  },
  "multi_archetype_synthesis_verify": {
    "template": "\n**GOAL (STEP 2 \u0192?\" VERIFY):**\nYou are verifying the DRAFT synthesis against the original lane findings.\nYour job is to REMOVE any unsupported or speculative content.\n\n**INPUTS:**\n1) Lane Findings (ground truth, already validated):\n{{laneFindings}}\n\n2) DRAFT Synthesis (from Step 1):\n{{draftSynthesisJson}}\n\n**STRICT RULES:**\n- You may ONLY do the following:\n  - Keep statements that are directly supported by at least one lane finding.\n  - Delete statements or details that are NOT supported by any lane finding.\n  - When in doubt, DELETE the questionable content (deletion is preferred over rewording).\n- You are NOT allowed to:\n  - Introduce any new facts, dates, or interpretations.\n  - Add new explanations, hypotheses, or guidelines.\n  - Rewrite the structure of the JSON (field names, nesting) beyond\n    deleting unsupported content or tightening wording inside existing fields.\n\n**HOW TO VERIFY:**\nFor each factual statement in the DRAFT:\n- Check whether it is directly supported by one or more lane findings.\n- If supported \u0192+' keep it as is or lightly sharpen wording WITHOUT changing meaning.\n- If NOT supported \u0192+' remove that statement (or the part of the text that is unsupported).\n\nIf lanes disagree:\n- You may keep a statement that explicitly says there is disagreement, but it MUST\n  be clearly grounded in the lane text (e.g., \"Lane A says X, Lane B says Y\").\n\n**OUTPUT REQUIREMENTS:**\n- Return a single JSON object using the EXACT SAME schema as the DRAFT\n  (multi_archetype_synthesis schema).\n- Do NOT add new fields.\n- Do NOT add any metadata about what you removed.\n- The JSON should be a \"cleaned\" version of the DRAFT with unsupported content removed.\n\nReturn ONLY the verified JSON object. No comments, no chain-of-thought.\n"
  }
}