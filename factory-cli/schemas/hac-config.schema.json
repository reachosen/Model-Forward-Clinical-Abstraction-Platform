{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/schemas/hac-config.schema.json",
  "title": "HACConfig",
  "description": "Complete configuration for a Hospital-Acquired Condition detection system",
  "type": "object",
  "required": [
    "config_metadata",
    "domain",
    "surveillance",
    "signals",
    "timeline",
    "prompts",
    "criteria"
  ],
  "properties": {
    "config_metadata": {
      "type": "object",
      "required": ["config_id", "name", "concern_id", "version", "archetype", "created_at", "status"],
      "properties": {
        "config_id": {
          "type": "string",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "concern_id": {
          "type": "string",
          "pattern": "^[A-Z0-9_]+$"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$"
        },
        "archetype": {
          "type": "string"
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "modified_at": {
          "type": "string",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "enum": ["draft", "active", "deprecated"]
        }
      }
    },
    "domain": {
      "type": "object",
      "required": ["name", "display_name", "description"],
      "properties": {
        "name": {
          "type": "string"
        },
        "display_name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "facility_context": {
          "type": "object"
        }
      }
    },
    "surveillance": {
      "type": "object",
      "required": ["objective", "population"],
      "properties": {
        "objective": {
          "type": "string",
          "minLength": 1
        },
        "population": {
          "type": "string",
          "minLength": 1
        },
        "detection_window": {
          "type": "object",
          "properties": {
            "lookback_days": {
              "type": "number",
              "minimum": 0
            },
            "lookahead_days": {
              "type": "number",
              "minimum": 0
            }
          }
        },
        "reporting": {
          "type": "object",
          "properties": {
            "frequency": {
              "type": "string",
              "enum": ["daily", "weekly", "monthly", "quarterly", "annual"]
            },
            "frameworks": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "signals": {
      "type": "object",
      "required": ["signal_groups"],
      "properties": {
        "signal_groups": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/SignalGroup"
          }
        },
        "thresholds": {
          "type": "object",
          "properties": {
            "min_confidence": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "max_findings_per_category": {
              "type": "number",
              "minimum": 1
            }
          }
        }
      }
    },
    "timeline": {
      "type": "object",
      "required": ["phases"],
      "properties": {
        "phases": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/TimelinePhase"
          }
        },
        "display_preferences": {
          "type": "object",
          "properties": {
            "default_view": {
              "type": "string"
            },
            "highlight_critical_events": {
              "type": "boolean"
            }
          }
        }
      }
    },
    "prompts": {
      "type": "object",
      "required": ["system_prompt", "task_prompts"],
      "properties": {
        "system_prompt": {
          "type": "string",
          "minLength": 1
        },
        "task_prompts": {
          "type": "object",
          "properties": {
            "enrichment": {
              "type": "string"
            },
            "abstraction": {
              "type": "string"
            },
            "qa": {
              "type": "string"
            }
          }
        },
        "output_formats": {
          "type": "object"
        }
      }
    },
    "criteria": {
      "type": "object",
      "required": ["rules"],
      "properties": {
        "rules": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/ClinicalRule"
          }
        },
        "determination_logic": {
          "type": "string"
        }
      }
    },
    "questions": {
      "type": "object",
      "description": "Questions configuration. For HAC: follow-up questions for clinicians. For USNWR: main abstraction questions array.",
      "properties": {
        "followup_questions": {
          "type": "array",
          "description": "Follow-up questions for clinicians (HAC-style)",
          "items": {
            "$ref": "#/definitions/FollowUpQuestion"
          }
        },
        "generation_rules": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "usnwr_questions": {
          "type": "array",
          "description": "USNWR metric abstraction questions - array of questions for a metric like I25",
          "items": {
            "$ref": "#/definitions/USNWRQuestionConfig"
          }
        }
      }
    },
    "summary_config": {
      "type": "object",
      "properties": {
        "key_fields": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "generation_rules": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "display_preferences": {
          "type": "object"
        }
      }
    }
  },
  "definitions": {
    "SignalGroup": {
      "type": "object",
      "required": ["group_id", "display_name", "description", "signal_types"],
      "properties": {
        "group_id": {
          "type": "string"
        },
        "display_name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "signal_types": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string"
          }
        },
        "priority": {
          "type": "number",
          "minimum": 0
        },
        "thresholds": {
          "type": "object",
          "properties": {
            "min_confidence": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "max_signals": {
              "type": "number",
              "minimum": 1
            }
          }
        }
      }
    },
    "TimelinePhase": {
      "type": "object",
      "required": ["phase_id", "display_name", "description", "timing"],
      "properties": {
        "phase_id": {
          "type": "string"
        },
        "display_name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "timing": {
          "type": "string",
          "enum": ["pre_event", "peri_event", "post_event", "surveillance"]
        },
        "duration": {
          "type": "object",
          "properties": {
            "min_days": {
              "type": "number",
              "minimum": 0
            },
            "max_days": {
              "type": "number",
              "minimum": 0
            },
            "typical_days": {
              "type": "number",
              "minimum": 0
            }
          }
        },
        "key_events": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "ClinicalRule": {
      "type": "object",
      "required": ["rule_id", "name", "description", "logic"],
      "properties": {
        "rule_id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "framework": {
          "type": "string"
        },
        "logic": {
          "type": "string"
        },
        "required_data": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "weight": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        }
      }
    },
    "FollowUpQuestion": {
      "type": "object",
      "required": ["question_id", "question_text", "category", "required"],
      "properties": {
        "question_id": {
          "type": "string"
        },
        "question_text": {
          "type": "string"
        },
        "category": {
          "type": "string",
          "enum": ["clinical", "temporal", "contextual", "regulatory"]
        },
        "required": {
          "type": "boolean"
        },
        "conditions": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "answer_type": {
          "type": "string",
          "enum": ["text", "yes_no", "numeric", "date", "multiple_choice"]
        }
      }
    },
    "USNWRQuestionConfig": {
      "type": "object",
      "required": ["question_id", "question_text", "metric_id"],
      "description": "USNWR metric abstraction question configuration",
      "properties": {
        "question_id": {
          "type": "string",
          "description": "Unique question identifier (e.g., I25_Q1)",
          "pattern": "^[A-Z0-9_]+$"
        },
        "question_text": {
          "type": "string",
          "description": "Human-readable question text",
          "minLength": 1
        },
        "metric_id": {
          "type": "string",
          "description": "Parent metric identifier (e.g., I25)",
          "pattern": "^[A-Z0-9_]+$"
        },
        "phase_ids": {
          "type": "array",
          "description": "Timeline phase IDs this question spans",
          "items": {
            "type": "string"
          }
        },
        "evidence_rules": {
          "type": "object",
          "description": "Rules for evidence collection",
          "properties": {
            "signal_groups": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "note_types": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "timeframe": {
              "type": "object",
              "properties": {
                "lookback_days": {
                  "type": "number",
                  "minimum": 0
                },
                "lookahead_days": {
                  "type": "number",
                  "minimum": 0
                }
              }
            },
            "custom": {
              "type": "object"
            }
          }
        },
        "followup_questions": {
          "type": "array",
          "description": "Ask-the-Case prompts for this question",
          "items": {
            "type": "string"
          }
        },
        "scoring_rules": {
          "type": "object",
          "description": "Scoring rules for Yes/No/Unable determinations",
          "properties": {
            "yes_criteria": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "no_criteria": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "unable_criteria": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "custom": {
              "type": "object"
            }
          }
        },
        "category": {
          "type": "string",
          "description": "Question category or type",
          "examples": ["outcome", "process", "structural"]
        },
        "required": {
          "type": "boolean",
          "description": "Whether this question is required"
        },
        "display_order": {
          "type": "number",
          "description": "Display order within the metric",
          "minimum": 0
        }
      }
    }
  }
}
