{
  "version": "2.0.0",
  "schema_version": "1.0.0",
  "task_definitions": {
    "enrichment": {
      "task_id": "clabsi.enrichment",
      "task_type": "enrichment",
      "description": "Process raw patient data into signal groups, timeline phases, and enrichment summary",
      "mode": "batch",
      "prompt_version": "v2024.11.1",
      "inputs": {
        "case_id": {"type": "string", "required": true},
        "patient_section": {"type": "object", "required": true, "schema": "PatientSection"}
      },
      "outputs": {
        "signal_groups": {"type": "array", "items": "SignalGroup"},
        "timeline_phases": {"type": "array", "items": "TimelinePhase"},
        "summary": {"type": "object", "schema": "EnrichmentSummary"},
        "task_metadata": {"type": "object", "schema": "TaskMetadata"}
      },
      "success_criteria": {
        "min_signal_groups": 1,
        "min_timeline_phases": 1,
        "min_summary_findings": 1,
        "max_execution_time_ms": 10000
      },
      "dependencies": [],
      "prompt_template_key": "enrichment_prompt"
    },
    "abstraction": {
      "task_id": "clabsi.abstraction",
      "task_type": "abstraction",
      "description": "Evaluate NHSN CLABSI criteria and generate clinical narrative",
      "mode": "interactive",
      "prompt_version": "v2024.11.1",
      "inputs": {
        "case_id": {"type": "string", "required": true},
        "patient_section": {"type": "object", "required": true},
        "enrichment_section": {"type": "object", "required": true}
      },
      "outputs": {
        "narrative": {"type": "string"},
        "criteria_evaluation": {"type": "object", "schema": "CriteriaEvaluation"},
        "exclusion_analysis": {"type": "array", "items": "ExclusionCriterion"},
        "task_metadata": {"type": "object", "schema": "TaskMetadata"}
      },
      "success_criteria": {
        "min_confidence": 0.75,
        "all_required_criteria_evaluated": true,
        "narrative_min_length": 100,
        "max_execution_time_ms": 15000
      },
      "dependencies": ["enrichment"],
      "prompt_template_key": "abstraction_prompt"
    },
    "interrogation_explain": {
      "task_id": "clabsi.interrogation.explain",
      "task_type": "interrogation",
      "description": "Explain specific aspects of the case (criterion, signal, event, overall)",
      "mode": "interactive",
      "interrogation_mode": "explain",
      "prompt_version": "v2024.11.1",
      "inputs": {
        "task_id": {"type": "string", "required": true, "description": "ID of task being interrogated"},
        "question": {"type": "string", "required": true, "max_length": 500},
        "interrogation_context": {
          "type": "object",
          "required": true,
          "properties": {
            "mode": {"type": "string", "enum": ["explain"]},
            "target_type": {"type": "string", "enum": ["criterion", "signal", "event", "overall"]},
            "target_id": {"type": "string"},
            "target_label": {"type": "string", "required": false}
          }
        }
      },
      "outputs": {
        "qa_entry": {"type": "object", "schema": "QAHistoryEntry"}
      },
      "success_criteria": {
        "min_confidence": 0.7,
        "min_citations": 1,
        "max_execution_time_ms": 8000
      },
      "dependencies": ["abstraction"],
      "prompt_template_key": "interrogation_explain_prompt"
    },
    "interrogation_summarize": {
      "task_id": "clabsi.interrogation.summarize",
      "task_type": "interrogation",
      "description": "Summarize specific aspects of the case for quick understanding",
      "mode": "interactive",
      "interrogation_mode": "summarize",
      "prompt_version": "v2024.11.1",
      "inputs": {
        "task_id": {"type": "string", "required": true},
        "question": {"type": "string", "required": true, "max_length": 500},
        "interrogation_context": {
          "type": "object",
          "required": true,
          "properties": {
            "mode": {"type": "string", "enum": ["summarize"]},
            "target_type": {"type": "string", "enum": ["criterion", "signal", "event", "overall"]},
            "target_id": {"type": "string"}
          }
        }
      },
      "outputs": {
        "qa_entry": {"type": "object", "schema": "QAHistoryEntry"}
      },
      "success_criteria": {
        "min_confidence": 0.7,
        "max_answer_length": 200,
        "max_execution_time_ms": 5000
      },
      "dependencies": ["abstraction"],
      "prompt_template_key": "interrogation_summarize_prompt"
    },
    "interrogation_validate": {
      "task_id": "clabsi.interrogation.validate",
      "task_type": "interrogation",
      "description": "Validate conclusions and check for contradictions or missing evidence",
      "mode": "interactive",
      "interrogation_mode": "validate",
      "prompt_version": "v2024.11.1",
      "inputs": {
        "task_id": {"type": "string", "required": true},
        "question": {"type": "string", "required": true, "max_length": 500},
        "interrogation_context": {
          "type": "object",
          "required": true,
          "properties": {
            "mode": {"type": "string", "enum": ["validate"]},
            "target_type": {"type": "string", "enum": ["criterion", "signal", "event", "overall"]},
            "target_id": {"type": "string"}
          }
        }
      },
      "outputs": {
        "qa_entry": {"type": "object", "schema": "QAHistoryEntry"}
      },
      "success_criteria": {
        "min_confidence": 0.8,
        "min_citations": 2,
        "max_execution_time_ms": 10000
      },
      "dependencies": ["abstraction"],
      "prompt_template_key": "interrogation_validate_prompt"
    },
    "evidence_retrieval": {
      "task_id": "retrieve_clabsi_evidence",
      "task_type": "utility",
      "description": "Retrieve evidence related to central line placement and bloodstream infection",
      "mode": "batch",
      "prompt_version": "v2024.11.1",
      "inputs": {
        "patient_id": {"type": "string", "required": true},
        "query": {"type": "string", "required": true},
        "date_range": {"type": "object", "required": false}
      },
      "outputs": {
        "evidence_list": {"type": "array", "items": "Evidence"},
        "relevance_scores": {"type": "array", "items": "number"}
      },
      "success_criteria": {
        "min_relevance_score": 0.7,
        "max_execution_time_ms": 5000
      },
      "prompt_template_key": "evidence_retrieval_prompt"
    },
    "rule_evaluation": {
      "task_id": "evaluate_clabsi_rules",
      "task_type": "legacy_rule_eval",
      "description": "Evaluate all NHSN CLABSI criteria against patient data (legacy task, use abstraction task instead)",
      "mode": "batch",
      "prompt_version": "v2024.11.1",
      "deprecated": true,
      "replacement_task": "abstraction",
      "inputs": {
        "patient_id": {"type": "string", "required": true},
        "encounter_id": {"type": "string", "required": false}
      },
      "outputs": {
        "summary": {"type": "object"},
        "evaluations": {"type": "array", "items": "RuleEvaluation"}
      },
      "success_criteria": {
        "all_required_rules_evaluated": true,
        "min_confidence": 0.75
      },
      "prompt_template_key": "rule_evaluation"
    },
    "qa_response": {
      "task_id": "answer_clabsi_question",
      "task_type": "legacy_qa",
      "description": "Answer natural language questions about CLABSI cases (legacy task, use interrogation tasks instead)",
      "mode": "interactive",
      "prompt_version": "v2024.11.1",
      "deprecated": true,
      "replacement_task": "interrogation_explain",
      "inputs": {
        "patient_id": {"type": "string", "required": true},
        "question": {"type": "string", "required": true}
      },
      "outputs": {
        "answer": {"type": "string"},
        "evidence_citations": {"type": "array"},
        "confidence": {"type": "number"}
      },
      "success_criteria": {
        "min_confidence": 0.7,
        "min_citations": 1
      },
      "prompt_template_key": "question_answering"
    }
  },
  "prompt_versions": {
    "v2024.11.1": {
      "version_date": "2024-11-17",
      "description": "Initial version for 4-section structured case model",
      "changes": [
        "Added enrichment task prompts",
        "Added abstraction task prompts",
        "Added interrogation task prompts (explain, summarize, validate)",
        "Deprecated legacy rule_evaluation and qa_response tasks"
      ]
    }
  }
}
