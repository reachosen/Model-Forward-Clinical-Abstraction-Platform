{
  "core_memory_max_tokens": 8000,

  "pruning_policy": {
    "temporal_window_days": 14,
    "keep_critical_events": ["line_insertion", "blood_culture", "fever_onset"],
    "min_relevance_score": 0.5,
    "max_documents_per_query": 10,
    "compress_verbose_outputs": true,
    "max_output_tokens": 2000,
    "max_conversation_turns": 10,
    "summarize_old_turns": true
  },

  "priming_config": {
    "priming_commands": {
      "/prime_CLABSI": {
        "command": "/prime_CLABSI",
        "knowledge_chunks": ["nhsn_clabsi_criteria", "device_definitions", "organism_rules"],
        "max_tokens": 4000,
        "ttl_seconds": 3600
      }
    },
    "auto_prime_on": ["new_case", "domain_switch"],
    "knowledge_base_id": "clabsi_knowledge_v1",
    "static_primers": []
  },

  "delegated_task_list": [
    "complex_timeline_analysis",
    "multi_rule_evaluation",
    "evidence_synthesis"
  ],

  "delegation_thresholds": {
    "estimated_tokens_threshold": 40000,
    "multi_source_threshold": 5,
    "reasoning_depth_threshold": 3,
    "max_parallel_subagents": 3,
    "subagent_timeout_seconds": 60,
    "force_delegate": [],
    "never_delegate": ["simple_date_calc"]
  },

  "context_bundle_config": {
    "include_inputs": true,
    "include_outputs": true,
    "include_reasoning": true,
    "include_tool_calls": false,
    "max_bundle_tokens": 2000,
    "compression_strategy": "summarize",
    "format": "json"
  },

  "golden_corpus_id": "clabsi_nhsn_2024_v1",

  "quality_gates": {
    "min_recall_at_5": 0.85,
    "min_recall_at_10": 0.90,
    "min_mrr": 0.90,
    "min_clinical_accuracy": 0.90,
    "min_citation_quality": 0.85,
    "max_calibration_error": 0.10,
    "max_p95_latency_ms": 5000,
    "min_cache_hit_rate": 0.60,
    "fail_action": "warn",
    "auto_tune_on_fail": true
  },

  "eval_config": {
    "test_cases_per_domain": 100,
    "test_generation_method": "hybrid",
    "eval_metrics": ["recall_at_5", "recall_at_10", "mrr", "accuracy"],
    "eval_frequency": "pre_deploy",
    "require_sme_validation": true,
    "sme_sample_rate": 0.1,
    "compare_to_baseline": "clabsi_v0.9.0",
    "regression_threshold": 0.05
  },

  "agent_profiles": [
    {
      "agent_id": "evidence_retrieval_clabsi_v1",
      "agent_type": "retrieval",
      "base_prompt": "You are an evidence retrieval specialist for healthcare-associated infections. Your role is to find relevant clinical evidence from patient records using semantic search. Focus on precision and relevance.",
      "domain_specific_prompt": "Focus on CLABSI-specific evidence including: central line placement/removal dates, blood culture results, organism identification, clinical symptoms (fever, chills, hypotension), device days, and infection window calculations.",
      "available_tools": ["vector_search", "temporal_filter", "relevance_ranker"],
      "max_tool_calls": 5,
      "max_tokens": 20000,
      "timeout_seconds": 30,
      "min_confidence_threshold": 0.7,
      "require_evidence": true,
      "cache_responses": true,
      "cache_ttl_seconds": 3600
    },
    {
      "agent_id": "rule_evaluation_clabsi_v1",
      "agent_type": "evaluation",
      "base_prompt": "You are a clinical decision support agent specializing in NHSN criteria evaluation. Your role is to systematically evaluate each criterion against patient data and provide evidence-based assessments.",
      "domain_specific_prompt": "Evaluate CLABSI criteria according to NHSN definitions: 1) Central line >2 calendar days, 2) Positive blood culture with recognized pathogen or common commensal with specific criteria, 3) Clinical signs/symptoms, 4) No alternate source. Pay special attention to device days, infection window periods, and organism classification.",
      "available_tools": ["rule_matcher", "temporal_calculator", "evidence_validator"],
      "max_tool_calls": 10,
      "max_tokens": 30000,
      "timeout_seconds": 45,
      "min_confidence_threshold": 0.75,
      "require_evidence": true,
      "cache_responses": true,
      "cache_ttl_seconds": 1800
    },
    {
      "agent_id": "qa_response_clabsi_v1",
      "agent_type": "qa",
      "base_prompt": "You are a clinical Q&A assistant helping healthcare professionals understand complex clinical cases. Provide clear, evidence-based answers with specific citations. Always acknowledge uncertainty when appropriate.",
      "domain_specific_prompt": "When answering questions about CLABSI cases, reference specific NHSN criteria, cite clinical evidence with timestamps, explain temporal relationships, and provide context about infection windows and device days. Use clear medical terminology while remaining accessible.",
      "available_tools": ["evidence_retrieval", "timeline_analysis", "citation_formatter"],
      "max_tool_calls": 8,
      "max_tokens": 25000,
      "timeout_seconds": 40,
      "min_confidence_threshold": 0.7,
      "require_evidence": true,
      "cache_responses": true,
      "cache_ttl_seconds": 1800
    },
    {
      "agent_id": "timeline_analysis_clabsi_v1",
      "agent_type": "timeline",
      "base_prompt": "You are a timeline analysis specialist for clinical cases. Your role is to identify temporal phases, critical events, and infection windows. Create clear chronological narratives.",
      "domain_specific_prompt": "For CLABSI cases, identify key phases: device placement, infection window (typically Day 3-7), symptom onset, culture collection, organism identification. Flag critical events and temporal relationships relevant to NHSN criteria.",
      "available_tools": ["event_sorter", "phase_identifier", "window_calculator"],
      "max_tool_calls": 6,
      "max_tokens": 20000,
      "timeout_seconds": 35,
      "min_confidence_threshold": 0.75,
      "require_evidence": false,
      "cache_responses": true,
      "cache_ttl_seconds": 3600
    },
    {
      "agent_id": "summary_generation_clabsi_v1",
      "agent_type": "summary",
      "base_prompt": "You are a clinical case summarization specialist. Create concise, comprehensive summaries highlighting key findings, supporting evidence, contradictions, and recommended actions.",
      "domain_specific_prompt": "For CLABSI summaries, include: device information, culture results with organisms, symptom timeline, NHSN criteria status, evidence quality assessment, and recommended clinical actions. Flag any missing or conflicting information.",
      "available_tools": ["evidence_aggregator", "contradiction_detector", "recommendation_generator"],
      "max_tool_calls": 7,
      "max_tokens": 25000,
      "timeout_seconds": 45,
      "min_confidence_threshold": 0.7,
      "require_evidence": true,
      "cache_responses": true,
      "cache_ttl_seconds": 1800
    }
  ],

  "vector_store_config": {
    "provider": "pinecone",
    "index_name": "clabsi-clinical-data",
    "embedding_model": "text-embedding-3-large",
    "dimension": 1536,
    "top_k": 10,
    "rerank": true,
    "rerank_model": "cohere-rerank-v3",
    "use_cache": true,
    "cache_ttl_seconds": 3600
  },

  "memory_store_config": {
    "provider": "redis",
    "connection_string": "redis://localhost:6379",
    "key_prefix": "ca_factory:clabsi:",
    "default_ttl_seconds": 3600,
    "agent_state_ttl_seconds": 7200,
    "context_bundle_ttl_seconds": 1800
  },

  "logging_config": {
    "level": "info",
    "console": true,
    "file": true,
    "file_path": "/var/log/ca_factory/clabsi.log",
    "format": "json",
    "include_timestamps": true,
    "include_request_id": true,
    "log_token_usage": true,
    "log_latency": true,
    "log_cache_hits": true,
    "redact_phi": true,
    "redact_patterns": ["\\d{3}-\\d{2}-\\d{4}", "MRN:\\s*\\w+"]
  }
}
